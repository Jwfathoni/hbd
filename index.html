<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Tabungan Liburan</title>

<style>
body{
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
  padding:20px;
}
.container{max-width:900px;margin:auto}
.card{
  background:rgba(255,255,255,0.15);
  padding:20px;
  border-radius:15px;
  margin-bottom:20px;
}
h1{text-align:center}
input,button{
  padding:10px;
  border-radius:8px;
  border:none;
}
button{cursor:pointer;font-weight:bold}
table{width:100%;border-collapse:collapse}
th,td{
  border:1px solid rgba(255,255,255,0.3);
  padding:8px;
  text-align:center;
}
.month-row{
  background:rgba(0,0,0,0.4);
  font-weight:bold;
}
</style>
</head>

<body>
<div class="container">

<!-- LOGIN -->
<div class="card" id="loginBox">
  <h1>üîê Login Tabungan Liburan</h1>
  <p>Password: <b>joni</b> atau <b>mona</b></p>
  <input type="password" id="password" placeholder="Masukkan password">
  <button onclick="login()">Login</button>
  <p id="error" style="color:#ff5252"></p>
</div>

<!-- APP -->
<div class="card" id="app" style="display:none">
  <h1>üèñÔ∏è Tabungan Liburan</h1>

  <table>
    <thead>
      <tr>
        <th>Tanggal</th>
        <th>Hari</th>
        <th>Joni</th>
        <th>Mona</th>
      </tr>
    </thead>
    <tbody id="tabel"></tbody>
  </table>
</div>

</div>

<script>
const WORKER_URL = "https://tabunngan.joniwijayaf888.workers.dev/";
let TOKEN = "";

const mulai = new Date("2025-12-26");
const akhir = new Date("2026-03-20");
let data = {};

function namaHari(d){
  return d.toLocaleDateString("id-ID",{weekday:"long"});
}
function namaBulan(d){
  return d.toLocaleDateString("id-ID",{month:"long",year:"numeric"});
}

// ===== LOGIN =====
async function login(){
  const pass = document.getElementById("password").value;
  TOKEN = pass;

  try{
    const res = await fetch(WORKER_URL,{
      headers:{ Authorization:`Bearer ${TOKEN}` }
    });

    if(!res.ok) throw "fail";

    document.getElementById("loginBox").style.display="none";
    document.getElementById("app").style.display="block";

    data = await res.json();
    render();
  }catch{
    document.getElementById("error").textContent="Password salah!";
  }
}

// ===== SAVE =====
async function saveData(){
  await fetch(WORKER_URL,{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      Authorization:`Bearer ${TOKEN}`
    },
    body:JSON.stringify(data)
  });
}

function render(){
  const tbody = document.getElementById("tabel");
  tbody.innerHTML="";
  let lastMonth="";

  for(let d=new Date(mulai); d<=akhir; d.setDate(d.getDate()+1)){
    const t = d.toISOString().split("T")[0];
    const bulan = namaBulan(d);

    if(bulan!==lastMonth){
      tbody.innerHTML += `<tr class="month-row"><td colspan="4">üìÜ ${bulan}</td></tr>`;
      lastMonth=bulan;
    }

    if(!data[t]) data[t]={joni:false,mona:false};

    tbody.innerHTML += `
      <tr>
        <td>${t}</td>
        <td>${namaHari(new Date(t))}</td>
        <td><input type="checkbox" ${data[t].joni?"checked":""}
            onchange="toggle('${t}','joni')"></td>
        <td><input type="checkbox" ${data[t].mona?"checked":""}
            onchange="toggle('${t}','mona')"></td>
      </tr>
    `;
  }
}

async function toggle(t,n){
  data[t][n]=!data[t][n];
  render();
  await saveData();
}
</script>

</body>
</html>
